---
layout: default
---
<div class="container-fluid">
    <!-- Header -->
    <div class="py-4">
        <div class="container">
            <div class="row">
                <div class="col">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb mb-3">
                            {% if page.freguesia_slug %}
                            <li class="breadcrumb-item">
                                <a href="{{ page.freguesia_slug | freguesia_relative_url }}">
                                    <i class="bi bi-map-fill"></i> Mapa
                                </a>
                            </li>
                            {% endif %}
                            {% if page.programa_pdf %}
                            <li class="breadcrumb-item">
                                <a href="/freguesias/{{ page.freguesia_slug }}/programa">
                                    <i class="bi bi-file-pdf"></i> Programa
                                </a>
                            </li>
                            {% endif %}
                            {% if page.freguesia_slug %}
                            <li class="breadcrumb-item active" aria-current="page">
                                <i class="bi bi-list-ul"></i> Propostas
                            </li>
                            {% endif %}
                        </ol>
                    </nav>

                    <h1 class="display-4 fw-bold mb-2">
                        {{ page.title | default: "Todas as Propostas" }}
                    </h1>
                    <p class="lead mb-0">
                        {{ page.description | default: "Conhe√ßa as nossas
                        propostas para transformar Lisboa" }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Under Construction Warning -->
    {% include under_construction_warning.html %}

    <!-- Eixo Legend -->
    <div class="container mb-4" id="eixoLegendContainer">
        <div class="row">
            <div class="col">
                <div class="card bg-light">
                    <div class="card-body">
                        <h6 class="card-title mb-3">
                            <i class="bi bi-palette-fill me-2"></i>
                            Eixos das Propostas
                        </h6>
                        <div id="eixoLegend" class="d-flex flex-wrap gap-2">
                            {% for eixo in page.eixos %}
                              <div class="d-flex align-items-center legend-item small" data-eixo="{{eixo}}" style="cursor: pointer;">
                                  <span class="badge {{ eixo | eixo_badge_class: page.freguesia_slug }} me-2" style="min-width: 20px; font-size: 0.7rem;">&nbsp;</span>
                                  {{ eixo }}
                              </div>
                            {% endfor %}
                        </div>
                        <div class="mt-2">
                            <button
                                class="btn btn-sm btn-outline-secondary"
                                id="clearEixoFilter"
                            >
                                <i class="bi bi-x-circle me-1"></i>
                                Mostrar Todos
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="container mb-4">
        <div class="row">
            <div class="col">
                <div class="d-flex flex-wrap gap-2 align-items-center">
                    {% if page.freguesia_slug %}
                    <a
                        href="{% if page.freguesia_slug %}{{ page.freguesia_slug | freguesia_relative_url }}{% else %}{{ site.baseurl }}/#map{% endif %}"
                        class="btn btn-outline-primary"
                    >
                        <i class="bi bi-map-fill me-2"></i>
                        Ver no Mapa
                    </a>
                    {% endif %}
                    {% if page.programa_pdf %}
                    <a
                        href="programa/"
                        class="btn btn-outline-primary"
                    >
                        <i class="bi bi-file-pdf me-2"></i>
                        Ver programa completo (PDF)
                    </a>
                    {% endif %}
                    <div class="ms-auto">
                        <input
                            type="text"
                            class="form-control"
                            id="searchPropostas"
                            placeholder="Pesquisar propostas..."
                            style="min-width: 300px"
                        />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Proposals Grid -->
    <div class="container mb-5">
        <div class="row g-4" id="propostasGrid">
            <!-- Automatically generate cards from proposta pages -->
            {% comment %} Find all pages in the same directory as current file
            {% endcomment %}
            {% assign all_propostas = site.pages | pages_in_same_directory: page %}
            {% for proposta in all_propostas %}
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 shadow-sm proposta-card">
                    {% if proposta.gx_media_links %} {% assign images =
                    proposta.gx_media_links | split: ' ' %} {% if images.size >
                    0 %}
                    <img
                        src="{{ site.baseurl }}{{ images[0] }}"
                        class="card-img-top"
                        alt="{{ proposta.proposta | default: proposta.title }}"
                        style="height: 200px; object-fit: cover"
                    />
                    {% else %}
                    <div
                        class="card-img-top bg-primary d-flex flex-column align-items-center justify-content-center text-white"
                        style="height: 200px"
                    >
                        <div class="text-center">
                            <h4 class="mb-1 text-uppercase">
                                <em>Viver</em> Lisboa
                            </h4>
                            <div class="h5 mb-3">
                                <code>{{page.title}}</code>
                                {% assign path_parts = proposta.path | split:
                                '/' %} {% for part in path_parts %} {% if part
                                == 'freguesias' %} {% assign next_index =
                                forloop.index %} {% break %} {% endif %} {%
                                endfor %} {% if next_index and
                                path_parts[next_index] %} {% assign
                                freguesia_slug = path_parts[next_index] %} {% if
                                freguesia_slug == 'arroios' %}Arroios{% elsif
                                freguesia_slug == 'alvalade' %}Alvalade{% else
                                %}{{ freguesia_slug | capitalize }}{% endif %}
                                {% else %}Lisboa{% endif %}
                            </div>
                            <div class="d-flex justify-content-center gap-1">
                                {% include card-parties.html parties=page.parties %}
                            </div>
                        </div>
                    </div>
                    {% endif %} {% else %}
                    <div
                        class="card-img-top bg-primary d-flex flex-column align-items-center justify-content-center text-white"
                        style="height: 200px"
                    >
                        <div class="text-center">
                            <h4 class="mb-1 text-uppercase"><em>Viver</em> Lisboa</h4>
                            <div class="h5 mb-3">
                                {{ page.freguesia }}
                            </div>
                            <div class="d-flex justify-content-center gap-1">
                                {% include card-parties.html parties=page.parties %}
                            </div>
                        </div>
                    </div>
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title">
                                {{ proposta.proposta | default: proposta.name
                                }}
                            </h5>
                            {% if proposta.sumario %} {% assign truncated_desc =
                            proposta.sumario %} {% if proposta.sumario.size >
                            150 %} {% assign truncated_desc = proposta.sumario |
                            slice: 0, 147 | append: "..." %} {% endif %}
                            <p class="card-text">{{ truncated_desc }}</p>
                            {% endif %}
                        </div>
                        <div class="card-footer bg-transparent">
                            <div
                                class="d-flex justify-content-between align-items-center"
                            >
                                <a
                                    href="{{ proposta | freguesia_proposta_url }}"
                                    class="btn btn-primary btn-sm me-auto text-nowrap flex-shrink-0"
                                >
                                    Ver Detalhes
                                </a>
                                {% if proposta.eixo %}
                                <small
                                    class="eixo-badge badge {{ proposta.eixo | eixo_badge_class: page.freguesia_slug }} flex-shrink-1"
                                    data-eixo="{{ proposta.eixo }}"
                                >
                                    <i class="bi bi-tag-fill me-1"></i>
                                    <span class="text-wrap">{{ proposta.eixo }}</span>
                                </small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <!-- Fallback content if no propostas found -->
                {% if all_propostas.size == 0 %}
                <div class="col-12">
                    <div class="text-center py-5">
                        <i
                            class="bi bi-lightbulb text-muted"
                            style="font-size: 3rem"
                        ></i>
                        <h3 class="text-muted mt-3">
                            Nenhuma proposta dispon√≠vel
                        </h3>
                        <p class="text-muted">
                            As propostas ser√£o adicionadas em breve
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- No results message -->
            <div id="noResults" class="text-center py-5" style="display: none">
                <i class="bi bi-search text-muted" style="font-size: 3rem"></i>
                <h3 class="text-muted mt-3">Nenhuma proposta encontrada</h3>
                <p class="text-muted">Tente pesquisar com outros termos</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            setupSearch();
            setupEixoLegendFilters();
        });

        function setupEixoLegendFilters() {
            const legendContainer = document.getElementById("eixoLegend");
            for (const legendItem of legendContainer.children) {
              const eixo = legendItem.dataset.eixo
              console.log(eixo)
              legendItem.addEventListener("click", function () {
                  filterByEixo(eixo);
                  updateLegendSelection(eixo);
              });

            }

            // Add clear filter handler
            document
                .getElementById("clearEixoFilter")
                .addEventListener("click", function () {
                    clearEixoFilter();
                    updateLegendSelection(null);
                });
        }

        function setupSearch() {
            const searchInput = document.getElementById("searchPropostas");
            searchInput.addEventListener("input", function (e) {
                filterPropostas(e.target.value.toLowerCase());
            });
        }

        function filterPropostas(searchTerm) {
            const cards = document.querySelectorAll(".proposta-card");
            const noResults = document.getElementById("noResults");
            let visibleCount = 0;

            cards.forEach((card) => {
                const title = card
                    .querySelector(".card-title")
                    .textContent.toLowerCase();
                const description =
                    card
                        .querySelector(".card-text")
                        ?.textContent.toLowerCase() || "";
                const eixoElement = card.querySelector(".eixo-badge");
                const eixo = eixoElement
                    ? eixoElement.textContent.toLowerCase().replace(/^.*\s/, "")
                    : "";

                if (
                    title.includes(searchTerm) ||
                    description.includes(searchTerm) ||
                    eixo.includes(searchTerm) ||
                    searchTerm === ""
                ) {
                    card.parentElement.style.display = "block";
                    visibleCount++;
                } else {
                    card.parentElement.style.display = "none";
                }
            });

            noResults.style.display =
                visibleCount === 0 && searchTerm !== "" ? "block" : "none";
        }

        function filterByEixo(selectedEixo) {
            const cards = document.querySelectorAll(".proposta-card");
            const noResults = document.getElementById("noResults");
            let visibleCount = 0;

            cards.forEach((card) => {
                const eixoElement = card.querySelector(".eixo-badge");
                const cardEixo = eixoElement
                    ? eixoElement.getAttribute("data-eixo")
                    : null;

                if (cardEixo === selectedEixo) {
                    card.parentElement.style.display = "block";
                    visibleCount++;
                } else {
                    card.parentElement.style.display = "none";
                }
            });

            noResults.style.display = visibleCount === 0 ? "block" : "none";

            // Clear search input when filtering by eixo
            document.getElementById("searchPropostas").value = "";
        }

        function clearEixoFilter() {
            const cards = document.querySelectorAll(".proposta-card");
            cards.forEach((card) => {
                card.parentElement.style.display = "block";
            });
            document.getElementById("noResults").style.display = "none";
        }

        function updateLegendSelection(selectedEixo) {
            const legendItems = document.querySelectorAll(".legend-item");
            legendItems.forEach((item) => {
                if (
                    selectedEixo &&
                    item.getAttribute("data-eixo") === selectedEixo
                ) {
                    item.style.backgroundColor = "#0d6efd";
                    item.style.color = "white";
                    item.style.borderRadius = "0.375rem";
                    item.style.padding = "0.25rem 0.5rem";
                    item.style.fontWeight = "bold";
                    item.style.transform = "scale(1.05)";
                    item.style.transition = "all 0.2s ease";
                } else {
                    item.style.backgroundColor = "transparent";
                    item.style.color = "";
                    item.style.padding = "0";
                    item.style.fontWeight = "";
                    item.style.transform = "scale(1)";
                    item.style.transition = "all 0.2s ease";
                }
            });
        }
    </script>
</div>
